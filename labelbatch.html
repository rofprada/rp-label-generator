<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RP LABELBATCH V2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 0 40px; border-bottom: 1px solid #30363d; height: 70px; }
        .btn-nav { background: transparent; border: 1px solid #30363d; color: #8b949e; padding: 6px 14px; font-size: 0.7rem; font-weight: 900; cursor: pointer; border-radius: 4px; text-transform: uppercase; }
        .manifest-row { border-bottom: 1px solid #161b22; transition: 0.1s; }
        .manifest-row:hover { background: #161b22; }
    </style>
</head>
<body>
    <div class="top-bar">
        <h1 class="font-black tracking-widest text-white text-sm uppercase">RP LABELBATCH V2.0</h1>
        <div class="flex gap-3">
            <button class="btn-nav" onclick="window.location.href='index.html'" style="color:#58a6ff">Hub</button>
            <button class="btn-nav" onclick="document.getElementById('csvIn').click()" style="color:#10b981">Load Manifest</button>
            <button class="btn-nav" onclick="resetManifest()" style="color:#f85149">Reset List</button>
            <input type="file" id="csvIn" class="hidden" onchange="handleCSV(this)">
        </div>
    </div>

    <main class="p-10 max-w-6xl mx-auto">
        <div class="bg-[#161b22] border border-[#30363d] rounded-2xl overflow-hidden min-h-[60vh] flex flex-col">
            <div class="grid grid-cols-5 p-4 bg-[#21262d] text-[10px] font-black uppercase tracking-widest text-gray-400">
                <div>Carrier</div>
                <div>Reference ID</div>
                <div class="text-center">Total PLT</div>
                <div class="text-center">Status</div>
                <div class="text-right">Action</div>
            </div>
            
            <div id="manifestList" class="flex-1 overflow-y-auto bg-black">
                <div id="empty-state" class="h-full flex flex-col items-center justify-center opacity-20 py-20">
                    <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    <p class="mt-4 font-black uppercase text-xs tracking-widest">No Manifest Loaded</p>
                </div>
            </div>
        </div>

        <div class="mt-8 flex justify-between items-center bg-[#161b22] p-6 rounded-2xl border border-[#30363d]">
            <div>
                <p id="stats-count" class="text-xs font-black text-gray-500 uppercase tracking-widest">Total Shipments: 0</p>
            </div>
            <button id="print-all-btn" disabled class="px-8 py-4 bg-gray-800 text-gray-500 font-black rounded-xl uppercase text-xs tracking-widest cursor-not-allowed transition">Print Batch Queue</button>
        </div>
    </main>

    <script>
        let GROUPS = {};

        function handleCSV(input) {
            const fr = new FileReader();
            fr.onload = (e) => {
                const wb = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
                const rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header: 1});
                
                GROUPS = {};
                for(let i=1; i<rows.length; i++) {
                    const l = rows[i];
                    if(!l || !l[2]) continue;
                    const isa = String(l[2]), carrier = String(l[4]).toUpperCase(), qty = parseInt(l[6])||1;
                    if(!GROUPS[isa]) GROUPS[isa] = { carrier, total: 0 };
                    GROUPS[isa].total += qty;
                }
                renderList();
            };
            fr.readAsArrayBuffer(input.files[0]);
        }

        function renderList() {
            const list = document.getElementById('manifestList');
            const stats = document.getElementById('stats-count');
            const printBtn = document.getElementById('print-all-btn');
            
            const ids = Object.keys(GROUPS);
            if(ids.length === 0) {
                list.innerHTML = `<div id="empty-state" class="h-full flex flex-col items-center justify-center opacity-20 py-20"><svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg><p class="mt-4 font-black uppercase text-xs tracking-widest">No Manifest Loaded</p></div>`;
                stats.textContent = "Total Shipments: 0";
                printBtn.disabled = true;
                printBtn.className = "px-8 py-4 bg-gray-800 text-gray-500 font-black rounded-xl uppercase text-xs tracking-widest cursor-not-allowed transition";
                return;
            }

            list.innerHTML = '';
            ids.forEach(id => {
                const g = GROUPS[id];
                const div = document.createElement('div');
                div.className = "grid grid-cols-5 p-6 manifest-row items-center";
                div.innerHTML = `
                    <div class="font-black text-white text-sm tracking-tight">${g.carrier}</div>
                    <div class="font-Inter text-gray-500 text-xs">${id}</div>
                    <div class="text-center font-black text-white">${g.total} PLT</div>
                    <div class="text-center text-[10px] font-black text-emerald-500 uppercase tracking-tighter">Ready</div>
                    <div class="text-right">
                        <button class="px-4 py-2 border border-[#30363d] text-[10px] font-black uppercase rounded hover:bg-white hover:text-black transition">Queue</button>
                    </div>
                `;
                list.appendChild(div);
            });

            stats.textContent = `Total Shipments: ${ids.length}`;
            printBtn.disabled = false;
            printBtn.className = "px-8 py-4 bg-[#58a6ff] text-black font-black rounded-xl uppercase text-xs tracking-widest hover:bg-blue-400 transition cursor-pointer";
        }

        /* THE RESET LOGIC */
        function resetManifest() {
            if(confirm("Are you sure you want to clear the current manifest list?")) {
                GROUPS = {};
                document.getElementById('csvIn').value = ''; // Clear file input
                renderList();
            }
        }
    </script>
</body>
</html>


